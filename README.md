# 年级成绩单拆分工具

该工具用于将多个学科的成绩单Excel文件按班级进行拆分，生成每个班级包含所有学科成绩的汇总表。

## 功能特点

- 支持多个Excel文件的批量处理
- 按班级自动拆分和汇总各科成绩
- 交互式命令行界面，操作简单直观
- 支持自定义工作目录
- 可处理已存在输出文件的情况

## 使用方法

### 启动程序

```bash
python main.py
```

程序启动后会显示如下界面：

```
请选择工作目录:
----------------------------------------
○ 扫描本文件夹下工作簿
● 手动输入文件夹路径

----------------------------------------
   [确认]   [取消]
```

### 操作步骤

1. **选择工作目录**
   - 扫描当前文件夹：使用程序所在目录下的Excel文件
   - 手动输入文件夹路径：可拖拽文件夹到命令行窗口获取路径

如果选择手动输入文件夹路径：
```
请输入文件夹路径 (支持拖入文件夹获取路径): C:\Users\Example\Documents\成绩表
工作目录: C:\Users\Example\Documents\成绩表
```

2. **处理已存在文件**
   - 如果输出目录"拆分"中已存在文件，程序会提示选择处理方式：
     - 退出程序，自行处理文件
     - 删除所有现有文件
     - 直接覆盖现有文件

```
警告: 输出目录 '拆分' 中已存在 8 个文件:
  - 1班.xlsx
  - 2班.xlsx
  - 3班.xlsx
  - 4班.xlsx
  - 5班.xlsx
  ... 还有 3 个文件
----------------------------------------
○ 退出程序，自行处理文件
● 删除所有现有文件
○ 直接覆盖现有文件

----------------------------------------
   [确认]   [取消]
```

3. **选择学科文件**
   - 程序会列出选定目录下的所有xlsx文件
   - 使用上下键选择，空格键勾选/取消勾选文件
   - A键全选/取消全选
   - 回车确认选择

```
找到以下Excel文件:
  - 语文.xlsx
  - 数学.xlsx
  - 英语.xlsx
  - 物理.xlsx
  - 化学.xlsx
请选择要处理的学科 xlsx 文件：
----------------------------------------
[×] 语文.xlsx
[×] 数学.xlsx
[×] 英语.xlsx
[×] 物理.xlsx
[×] 化学.xlsx

----------------------------------------
   [全选]   [下一步]   [取消]
```

4. **选择数据表**
   - 程序显示第一个文件的所有sheet列表
   - 输入包含学生成绩数据的sheet序号

```
所有学科的sheet结构相同，以下为第一个文件的sheet列表:
  1. 总分
  2. 学生得分
  3. 等级分布
  4. 分数段统计
请输入学生得分sheet的序号: 2
```

5. **设置表头和班级列**
   - 输入表头所在的行号
   - 输入班级信息所在的列号

```
请输入表头所在行号: 2
表头行（第2行）的前10个单元格内容:
  列1: 学号
  列2: 姓名
  列3: 班级
  列4: 语文
  列5: 数学
  列6: 英语
  列7: 物理
  列8: 化学
  列9: 总分
  列10: 平均分
请输入班级所在列号: 3
```

6. **查看结果**
   - 程序会在选定目录下创建"拆分"文件夹
   - 每个班级生成一个Excel文件，包含该班级所有学科的成绩

```
拆分完成，结果保存在 '拆分' 文件夹中。
```

## 实现方式

### 技术栈

- **Python**：主要编程语言
- **openpyxl**：Excel文件读写处理
- **prompt_toolkit**：交互式命令行界面

### 核心逻辑

1. **文件扫描**：扫描指定目录下的所有xlsx文件
2. **用户交互**：通过命令行界面让用户选择文件和设置参数
3. **数据提取**：从每个Excel文件中提取指定sheet的数据
4. **数据重组**：按班级将各学科成绩进行分组
5. **文件输出**：为每个班级生成包含所有学科成绩的Excel文件

### 目录结构

```
选定工作目录/
├── 学科1.xlsx
├── 学科2.xlsx
├── ...
└── 拆分/
    ├── 1班.xlsx
    ├── 2班.xlsx
    └── ...
```

### 输出格式

每个班级的Excel文件包含多个sheet，每个sheet对应一个学科的成绩：

- 第一行：学科名称和制表日期
- 第二行：表头信息
- 其余行：学生成绩数据

## 注意事项

- 确保所有Excel文件具有相同的结构
- 程序假设文件名即为学科名称
- sheet名称需包含"学生得分"关键字（在选择时确认）
- 输出文件会覆盖同名文件（根据用户选择的处理方式）