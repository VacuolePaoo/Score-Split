# 年级成绩单拆分工具

该工具用于将多个学科的成绩单Excel文件按班级进行拆分，生成每个班级包含所有学科成绩的汇总表。

## 运行环境

- Python 3.6 或更高版本
- 需要安装的第三方库：
  - openpyxl
  - prompt_toolkit

可通过以下命令安装依赖：
```bash
pip install openpyxl prompt_toolkit
```

## 快速开始

1. 将所有学科的成绩Excel文件放在同一文件夹中
2. 运行程序：
   ```bash
   python main.py
   ```
3. 按照界面提示进行操作

## 详细使用说明

### 1. 启动程序

在命令行中运行：
```bash
python main.py
```

程序启动后将显示工作目录选择界面：
```
请选择工作目录:
----------------------------------------
○ 扫描本文件夹下工作簿
● 手动输入文件夹路径

----------------------------------------
   [确认]   [退出]
```

### 2. 选择工作目录

- **扫描本文件夹下工作簿**：使用程序所在目录下的Excel文件
- **手动输入文件夹路径**：输入包含成绩文件的文件夹路径，支持拖拽文件夹到命令行窗口获取路径

选择后程序将显示工作目录路径：
```
工作目录: C:\Users\Example\Documents\成绩表
```

### 3. 处理已存在文件

如果输出目录"拆分"中已存在文件，程序会提示选择处理方式：
```
警告: 输出目录 '拆分' 中已存在 8 个文件:
  - 1班.xlsx
  - 2班.xlsx
  - 3班.xlsx
  - 4班.xlsx
  - 5班.xlsx
  ... 还有 3 个文件
----------------------------------------
○ 退出程序，自行处理文件
● 删除所有现有文件
○ 直接覆盖现有文件

----------------------------------------
   [确认]   [退出]
```

选择处理方式：
- **退出程序，自行处理文件**：程序退出，用户手动处理已存在文件
- **删除所有现有文件**：自动删除输出目录中的所有文件
- **直接覆盖现有文件**：保留已存在文件，新生成的文件将覆盖同名文件

### 4. 选择学科文件

程序会列出选定目录下的所有xlsx文件：
```
找到以下Excel文件:
  - 语文.xlsx
  - 数学.xlsx
  - 英语.xlsx
  - 物理.xlsx
  - 化学.xlsx
请选择要处理的学科 xlsx 文件：
----------------------------------------
[×] 语文.xlsx
[×] 数学.xlsx
[×] 英语.xlsx
[×] 物理.xlsx
[×] 化学.xlsx

----------------------------------------
   [全选]   [下一步]   [退出]
```

操作说明：
- 点击文件名可选择/取消选择文件
- 点击"全选"按钮可选择所有文件
- 选择完成后点击"下一步"

### 5. 选择数据表

程序显示第一个文件的所有sheet列表，让用户选择包含学生成绩数据的sheet：
```
请选择包含学生得分的sheet:
----------------------------------------
○ Sheet1
● 学生得分
○ 等级分布
○ 分数段统计

----------------------------------------
   [确认]   [退出]
```

### 6. 设置表头和班级列

程序显示表头行内容，需要设置相关信息：
```
表头行（第2行）的前10个单元格内容:
  列1: 学号
  列2: 姓名
  列3: 班级
  列4: 语文
  列5: 数学
  列6: 英语
  列7: 物理
  列8: 化学
  列9: 总分
  列10: 平均分
----------------------------------------
○ 列1: 学号
● 列2: 姓名
○ 列3: 班级
○ 列4: 语文
○ 列5: 数学
○ 列6: 英语
○ 列7: 物理
○ 列8: 化学
○ 列9: 总分
○ 列10: 平均分

----------------------------------------
   [确认]   [退出]
```

### 7. 学号列设置（可选）

如果需要忽略学号列，可以选择对应的列：
```
学号列忽略选项:
----------------------------------------
表头行内容:
○ 列1: 学号
● 列2: 姓名
○ 列3: 班级
○ 列4: 语文
○ 列5: 数学
○ 列6: 英语
○ 列7: 物理
○ 列8: 化学
○ 列9: 总分
○ 列10: 平均分

----------------------------------------
   [确认选择此列为学号列]   [不忽略任何列]

----------------------------------------
   [退出]
```

### 8. 班级列忽略设置

程序询问是否忽略班级列：
```
班级列忽略选项:
----------------------------------------
已选择的班级列为: 列3: 班级

是否忽略班级列?
----------------------------------------
   [是，忽略班级列]   [否，保留班级列]

----------------------------------------
   [退出]
```

### 9. 查看处理结果

程序处理完成后会显示统计信息和操作选项：
```
处理完成!
----------------------------------------
结果已保存在: 拆分
========================================
处理统计信息:
  处理文件数: 5/5
  跳过文件数: 0
  生成班级数: 8
  处理数据行数: 240
========================================
请选择操作:
----------------------------------------
   [打开输出文件夹]   [退出]
```

点击相应按钮完成操作：
- **打开输出文件夹**：打开包含拆分结果的文件夹
- **退出**：退出程序

## 配置文件

程序支持使用配置文件来跳过交互式选择步骤，提高处理效率。配置文件为 `config.json`，位于程序根目录。

### 配置文件结构

```json
{
  "configs": [
    {
      "name": "配置名称",
      "sheet_index": 0,
      "class_column": 3,
      "header_row": 2,
      "student_id_column": null,
      "ignore_class_column": false,
      "existing_files_action": null,
      "file_selection_mode": null,
      "auto_detect_directory": false
    }
  ]
}
```

### 配置参数说明

| 参数名 | 类型 | 说明 |
|--------|------|------|
| `name` | string | 配置的名称，用于在程序中显示和选择 |
| `sheet_index` | integer | 包含学生成绩数据的sheet索引（从0开始） |
| `class_column` | integer | 班级信息所在的列号（从1开始） |
| `header_row` | integer | 表头所在的行号（从1开始） |
| `student_id_column` | integer/null | 学号所在的列号，设置后会忽略该列；设为null则不忽略任何列 |
| `ignore_class_column` | boolean | 是否忽略班级列（true/false） |
| `existing_files_action` | string/null | 处理输出目录中已存在文件的方式，可选值："exit"（退出）、"delete"（删除）、"overwrite"（覆盖）、null（手动选择） |
| `file_selection_mode` | string/null | 文件选择模式，可选值："all"（自动全选所有文件）、"select"（手动选择）、null（手动选择） |
| `auto_detect_directory` | boolean | 是否自动检测运行文件夹，true表示直接使用程序所在目录，false或未设置表示手动选择目录 |
| `show_subject_header` | boolean | 是否在每个学科sheet的头部显示学科名称和制表日期，true表示显示，false表示不显示，默认为true |

### 使用配置文件

1. 程序首次运行时会自动生成默认配置文件
2. 可以手动编辑配置文件，添加多个配置方案
3. 程序启动时会显示配置选择界面，可选择使用预配置或自定义配置

```
选择配置:
----------------------------------------
请选择要使用的配置:
[配置名称]
----------------------------------------
   [自定义配置]   [退出]
```

选择预配置后，程序将自动使用配置中的参数，跳过相应的交互步骤。

在自定义模式下，程序还会询问是否在每个学科sheet的头部显示学科名称和制表日期：

```
学科和日期显示选项:
----------------------------------------
是否在每个学科sheet的头部显示学科名称和制表日期?
----------------------------------------
   [是]   [否]

----------------------------------------
   [退出]
```

选择"是"将在每个学科sheet的表头前添加一行显示学科名称和当前日期，选择"否"则不添加该行。
